<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ECharts</title>
    <script src="../js/echarts.min.js"></script>
    <script src="../js/echarts-gl.min.js"></script>
    <script src="../js/jquery-3.3.1.min.js"></script>
</head>
<body>
    <div id="chart" style="height:400px;"></div>
    <script type="text/javascript" src="../js/qwebchannel.js"></script>
    <script type="text/javascript">file:///C:/Qt/Qt5.12.1/Examples/Qt-5.12.1/webchannel/shared/qwebchannel.js
        // div height 100% doesn't work
        // 图表渲染的容器对象
        var chartContainer = document.getElementById("chart");
        var myChart = echarts.init(chartContainer);

        //window.onresize = myChart.resize;
        window.onresize = function(){
            myChart.resize();
        }

        window.onload = function()
        {
            new QWebChannel(qt.webChannelTransport, function(channel) {
                // all published objects are available in channel.objects under
                // the identifier set in their attached WebChannel.id property
                backend = channel.objects.backend;
                // connect to a signal
                backend.someSignal.connect(function(arg) {
                    refresh(arg);
                });
                backend.clearSignal.connect(function(arg) {
                    clearPoint();
                });
            });
        }

        var data = [["Distance","RSSI","Mark"],]
        var symbolSize = 3.5;
        var sizeValue = '55%';
        var config = {
            xtext : 'Distance',
            ytext : 'Mark',
            ztext : 'RSSI',
        }
        var tips = ['0','1','2','3','4','5','6','7','8','9']
        var option = {
            //backgroundColor: '#dddddd',
            visualMap: [{
               top: 10,
               tooltip: {trigger: 'item'},
               type: 'piecewise',
               //calculable: true,
               dimension: 2,// 'Mark'
               //max: 9,
               //min:  0,
               //splitNumber: 10,
               categories: tips,
               show: true,
               inRange: {
                   color: {
                        '0':'#ff4000', '1':'#ffbf00', '2':'#bfff00', '3':'#40ff00', '4':'#00ffbf',
                        '5':'#00bfff', '6':'#0040ff', '7':'#7f00ff', '8':'#ff00ff', '9':'#ff0080'
                   }
               },
               textStyle: {
                   color: '#000'
               }
            }],
            grid3D: {
                width: '45%',
                //height: '45%',
                left: '5%',
                bottom: '10%',
                axisLine: {
                    lineStyle: {
                        color: '#000'
                    }
                },
                axisPointer: {
                    lineStyle: {
                        color: '#ffbd67'
                    }
                },
                viewControl: {
                    autoRotate: true,
                    projection: 'orthographic',//'perspective'
                    //distance: 300,
                    //maxDistance: 400,
                    //minDistance: 40,
                    orthographicSize: 200,
                    maxorthographicSize: 400,
                    minorthographicSize: 40,
                },
                tooltip: {
                    trigger: 'item'
                },
            },
            xAxis3D: {name: config.xtext},
            yAxis3D: {
                        name: config.ytext,
                        type: 'category',
                        data: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'],
                      },
            zAxis3D: {name: config.ztext},
            dataset: {
                dimensions: [
                    'Distance',
                    'RSSI',
                    'Mark',
                ],
                source: data
            },
            grid: [
                    {width: '30%', left: '60%'},
                ],
                legend: {
                    data: ['Data']
                },
                toolbox: {
                    show: true,
                    feature: {
                        mark: { show: true },
                        dataZoom: { show: true },
                        dataView: { show: true, readOnly: false },
                        restore: { show: true },
                    }
                },
                tooltip: {
                    trigger: 'item'
                },
                xAxis: [
                    {type: 'value', name: config.xtext},
                ],
                yAxis: [
                    {type: 'value', name: config.ztext},
                ],
            series: [
            {
                id: 'scatter3D',
                name: 'scatter3D',
                type: 'scatter3D',
                symbolSize: symbolSize,
                encode: {
                    x: config.xtext,
                    y: config.ytext,
                    z: config.ztext,
                    //tooltip: [0, 1, 2]
                }
            },
            {
                id: 'scatter',
                name: 'scatter',
                type: 'scatter',
                symbolSize: symbolSize,
                markPoint: {
                    symbolSize: symbolSize+5,
                    data: [
                        { type: 'max', name: '最大值' },
                        { type: 'min', name: '最小值' }
                    ]
                },
                markLine: {
                    data: [
                        { type: 'average', name: '平均值' }
                    ]
                },
                encode: {
                    x: config.xtext,
                    y: config.ztext,
                    tooltip: [0, 1, 2]
                }
            }],
            dataZoom:[{
                type: 'inside',
                show: true,
                xAxisIndex: [0],
                realtime: true,
            }],
            toolbox: {
                //left: 'center',
                feature: {
                    dataZoom: {
                        //yAxisIndex: 'none',
                    },
                    restore: {},
                    //saveAsImage: {},
                    magicType: {
                        //type: ['line', 'bar', 'stack', 'tiled']
                    },
                    dataView: {},
                },
            },
            title: {
                left: 'center',
                text: ''
            },
        };

        myChart.setOption(option);

        function refresh(arg) {
            myChart.showLoading();
            arg.forEach(function(item) {
                data.push(item)
            })
            myChart.setOption(option);
            myChart.hideLoading();
        }

        function clearPoint() {
            //var img = new Image();
            //img.src = myChart.getDataURL({
                //pixelRatio: 2,
                //backgroundColor: '#fff'
            //});
            //backend.test(img)
            myChart.showLoading();
            myChart.clear();
            data.splice(0, data.length)
            myChart.setOption(option);
            myChart.hideLoading();
        }


        //$.getJSON("../data/life-expectancy-table.json", function (_data) { });


    </script>
</body>
</html>
